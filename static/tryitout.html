<!DOCTYPE html>
    <div>
        <h3>Try It Out!</h3>
        <div id="tio">
            Loading tryitout, if you have JS disabled, this feature may not work...
        </div>
        <div id="body">

        </div>
    </div>
</html>

<style>
    html {
        width: 100% !important;
    }

    /**Use similar styles to redoc**/
    div {
        font-family: Roboto, sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.5em;
        color: rgb(51, 51, 51);
        -webkit-font-smoothing: antialiased;
        text-size-adjust: 100%;
        text-rendering: optimizespeed !important;
    }

    h1, h2, h3, h4, h5, h6, span, ul, li, ol, p, small {
        display: block;
        margin-block-start: 1em;
        margin-block-end: 1em;
        margin-inline-start: 0px;
        margin-inline-end: 0px;
    }

    input {
        font-family: Roboto, sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.5em;
        color: rgb(51, 51, 51);
        -webkit-font-smoothing: antialiased;
        text-size-adjust: 100%;
        text-rendering: optimizespeed !important;
    }

    label {
        font-family: Roboto, sans-serif;
        font-weight: bold;
        font-size: 14px;
        line-height: 1.5em;
        color: rgb(51, 51, 51);
        -webkit-font-smoothing: antialiased;
        text-size-adjust: 100%;
        text-rendering: optimizespeed !important;
        margin-right: 5px;
    }

    .choices__inner {
        font-family: Roboto, sans-serif;
        font-weight: 400;
        font-size: 14px;
        line-height: 1.0em;
        color: rgb(51, 51, 51);
        -webkit-font-smoothing: antialiased;
        text-size-adjust: 100%;
        text-rendering: optimizespeed !important;
        padding: 0 !important;
        margin: 0 !important;
        max-width: 300px !important;
    }

    .choices {
        display: inline;
    }

    .choice-div {
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .choices__inner {
        min-height: 0 !important;
        padding: 0 !important;
    }

    .choices__list--dropdown {
        min-height: 0 !important;
        padding: 0 !important;
    }
</style>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script>
    String.prototype.toTitle = function() {
        return this.replaceAll("_", "").replace(/(^|\s)\S/g, function(t) { return t.toUpperCase() });
    };

    var tidDat = JSON.parse(atob(window.location.hash.substring(1)));

    console.log("Got TryItOut data: ", tidDat)

    function handleList(id, k, type) {
        let baseType = type.split(":")[1];
        let choiceEl = document.createElement("input");
        choiceEl.id = k;
        choiceEl.type = "text";

        let label = document.createElement("label");

        label.innerText = k.toTitle();

        let div = document.createElement("div");
        div.classList.add("choice-div");
        div.appendChild(label);
        div.appendChild(choiceEl);

        document.getElementById(id).appendChild(div);

        choices = new Choices(choiceEl, {
            allowHTML: true,
            items: [],
            choices: [],
            delimiter: ',',
            editItems: true,
            removeItemButton: true,
            renderSelectedChoices: 'auto',
            paste: true,
            searchEnabled: true,
            searchChoices: true,
            placeholder: true,
            addItemText: (value) => {
                return `Press Enter to add <b>"${value}"</b>`;
            },
            maxItemText: (maxItemCount) => {
                return `Only ${maxItemCount} values can be added`;
            },
            valueComparer: (value1, value2) => {
                return value1 === value2;
            },
            labelId: '',
            callbackOnInit: null,
            callbackOnCreateTemplates: null
        })
    }

    function _addAtLevel(id, level) {
        // Loop over body and add to body as inputs
        for(var key in level) {
            if(key == "_nested") {
                continue
            }

            if(level[key]._nested) {
                console.log("Handling nested")
                let h3 = document.createElement("h3");
                h3.innerText = key.toTitle();
                document.getElementById(id).appendChild(h3);
                _addAtLevel(id, level[key]);
                continue;
            }

            console.log(key)

            var val = level[key];

            el = document.createElement("div");
            el.classList.add("input")

            label = document.createElement("label");
            label.innerText = key.toTitle();
            label.htmlFor = id + "-" + "key";
            el.appendChild(label);

            console.log(val, level)

            if(val.startsWith("list")) {
                handleList(id, key, val)
                continue
            }

            input = document.createElement("input");
            input.id = id + "-" + key;
            input.name = key;
            input.type = val;
            input.innerText = key.toTitle();
            input.placeholder = key.toTitle();
            el.appendChild(input);

            document.getElementById(id).appendChild(el);
        }
    }

    if(Object.keys(tidDat.body).length > 0) {
        console.warn("Got body: ", tidDat.body)

        inputEl = "<h2>Body</h2>"

        document.getElementById("body").innerHTML += inputEl;

        _addAtLevel("body", tidDat.body);
    }
</script>